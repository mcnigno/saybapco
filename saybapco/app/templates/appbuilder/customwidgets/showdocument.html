{% import 'appbuilder/general/lib.html' as lib %}
{% include 'appbuilder/general/confirm.html' %}
{% include 'appbuilder/general/alert.html' %}

{% if fieldsets %}

    {% for fieldset_item in fieldsets %}
        {% if fieldset_item[1].get('expanded') == None %}
            {% set expanded = True %}
        {% else %}
            {% set expanded = fieldset_item[1].get('expanded') %}
        {% endif %}
        {% call lib.accordion_tag(loop.index,fieldset_item[0], expanded) %}
        <div class="table-responsive">
            
        <table class="table table-bordered">
            <th id="chartbox" class="col-lg-2 col-md-2 col-sm-2" rowspan="15">{{label_columns['code']}}: {{value_columns[0]}}
                <br>
                <br>
                    <iframe
                    width="450"
                    height="400"
                    seamless
                    frameBorder="0"
                    scrolling="no"
                    src="https://report.quasarpm.com/superset/explore/?form_data=%7B%22datasource%22%3A%2262__table%22%2C%22viz_type%22%3A%22pivot_table%22%2C%22slice_id%22%3A157%2C%22granularity_sqla%22%3A%22TransmDate%22%2C%22time_grain_sqla%22%3Anull%2C%22since%22%3A%22%22%2C%22until%22%3A%22now%22%2C%22groupby%22%3A%5B%22Response%22%5D%2C%22columns%22%3A%5B%22Unit%22%2C%22Materialclass%22%2C%22DocType%22%5D%2C%22metrics%22%3A%5B%22Total+CS%22%5D%2C%22row_limit%22%3A10000%2C%22pandas_aggfunc%22%3A%22sum%22%2C%22pivot_margins%22%3Afalse%2C%22number_format%22%3A%22.3s%22%2C%22combine_metric%22%3Atrue%2C%22where%22%3A%22DocumentCode+LIKE+%27{{value_columns[0]}}%27+%22%2C%22having%22%3A%22%22%2C%22filters%22%3A%5B%5D%2C%22order_desc%22%3Atrue%2C%22x_axis_format%22%3A%22smart_date%22%2C%22resample_rule%22%3Anull%2C%22rich_tooltip%22%3Atrue%2C%22y_axis_label%22%3A%22Number+Of+Comments%22%2C%22url_params%22%3A%7B%7D%2C%22period_ratio_type%22%3A%22growth%22%2C%22y_axis_bounds%22%3A%5B1%2C7%5D%2C%22num_period_compare%22%3A%22%22%2C%22order_bars%22%3Afalse%2C%22show_brush%22%3A%22yes%22%2C%22x_axis_label%22%3A%22Document%22%2C%22x_axis_showminmax%22%3Atrue%2C%22show_controls%22%3Atrue%2C%22timeseries_limit_metric%22%3Anull%2C%22x_ticks_layout%22%3A%22flat%22%2C%22color_scheme%22%3A%22lyftColors%22%2C%22show_bar_value%22%3Afalse%2C%22rolling_type%22%3A%22None%22%2C%22resample_fillmethod%22%3Anull%2C%22resample_how%22%3Anull%2C%22line_interpolation%22%3A%22linear%22%2C%22y_log_scale%22%3Afalse%2C%22bottom_margin%22%3A%22auto%22%2C%22left_margin%22%3A%22auto%22%2C%22time_compare%22%3Anull%2C%22reduce_x_ticks%22%3Afalse%2C%22annotation_layers%22%3A%5B%5D%2C%22bar_stacked%22%3Afalse%2C%22y_axis_format%22%3A%22.3s%22%2C%22contribution%22%3Afalse%2C%22show_legend%22%3Atrue%2C%22y_axis_showminmax%22%3Atrue%7D&standalone=true&height=400"
                    >
                    </iframe>
            </th>
            <td id="pivotbox" colspan="2">
                    <iframe
                    width="450"
                    height="300"
                    seamless
                    frameBorder="0"
                    scrolling="no"
                    src="https://report.quasarpm.com/superset/explore/?form_data=%7B%22datasource%22%3A%2262__table%22%2C%22viz_type%22%3A%22dist_bar%22%2C%22slice_id%22%3A156%2C%22granularity_sqla%22%3A%22TransmDate%22%2C%22time_grain_sqla%22%3Anull%2C%22since%22%3A%22%22%2C%22until%22%3A%22now%22%2C%22metrics%22%3A%5B%7B%22optionName%22%3A%22metric_9c8h1i1hcbp_97reev60htr%22%2C%22column%22%3A%7B%22optionName%22%3A%22_col_Comments%22%2C%22column_name%22%3A%22Comments%22%2C%22type%22%3A%22INT%22%2C%22groupby%22%3Atrue%2C%22is_dttm%22%3Afalse%2C%22verbose_name%22%3Anull%2C%22filterable%22%3Atrue%2C%22expression%22%3A%22%22%2C%22description%22%3Anull%7D%2C%22fromFormData%22%3Atrue%2C%22expressionType%22%3A%22SIMPLE%22%2C%22label%22%3A%22All+Comments%22%2C%22sqlExpression%22%3Anull%2C%22hasCustomLabel%22%3Atrue%2C%22aggregate%22%3A%22SUM%22%7D%2C%7B%22optionName%22%3A%22metric_9ngoqr700ze_sa1x9t72mr%22%2C%22column%22%3A%7B%22optionName%22%3A%22_col_Closed%22%2C%22column_name%22%3A%22Closed%22%2C%22type%22%3A%22OBJECT%22%2C%22groupby%22%3Atrue%2C%22is_dttm%22%3Afalse%2C%22verbose_name%22%3Anull%2C%22filterable%22%3Atrue%2C%22expression%22%3A%22%22%2C%22description%22%3Anull%7D%2C%22fromFormData%22%3Atrue%2C%22expressionType%22%3A%22SIMPLE%22%2C%22label%22%3A%22Closed%22%2C%22sqlExpression%22%3Anull%2C%22hasCustomLabel%22%3Atrue%2C%22aggregate%22%3A%22SUM%22%7D%5D%2C%22groupby%22%3A%5B%22DocumentCode%22%5D%2C%22columns%22%3A%5B%5D%2C%22row_limit%22%3A10000%2C%22contribution%22%3Afalse%2C%22color_scheme%22%3A%22lyftColors%22%2C%22show_legend%22%3Atrue%2C%22show_bar_value%22%3Afalse%2C%22bar_stacked%22%3Afalse%2C%22order_bars%22%3Afalse%2C%22y_axis_format%22%3A%22.3s%22%2C%22y_axis_label%22%3A%22Number+Of+Comments%22%2C%22show_controls%22%3Atrue%2C%22x_axis_label%22%3A%22Document%22%2C%22bottom_margin%22%3A%22auto%22%2C%22x_ticks_layout%22%3A%22flat%22%2C%22reduce_x_ticks%22%3Afalse%2C%22where%22%3A%22DocumentCode+LIKE+%27{{value_columns[0]}}%27+%22%2C%22having%22%3A%22%22%2C%22filters%22%3A%5B%5D%2C%22order_desc%22%3Atrue%2C%22x_axis_format%22%3A%22smart_date%22%2C%22resample_rule%22%3Anull%2C%22rich_tooltip%22%3Atrue%2C%22pandas_aggfunc%22%3A%22sum%22%2C%22combine_metric%22%3Afalse%2C%22url_params%22%3A%7B%7D%2C%22period_ratio_type%22%3A%22growth%22%2C%22y_axis_bounds%22%3A%5B1%2C7%5D%2C%22num_period_compare%22%3A%22%22%2C%22pivot_margins%22%3Atrue%2C%22show_brush%22%3A%22yes%22%2C%22x_axis_showminmax%22%3Atrue%2C%22resample_how%22%3Anull%2C%22rolling_type%22%3A%22None%22%2C%22resample_fillmethod%22%3Anull%2C%22timeseries_limit_metric%22%3Anull%2C%22line_interpolation%22%3A%22linear%22%2C%22y_log_scale%22%3Afalse%2C%22left_margin%22%3A%22auto%22%2C%22time_compare%22%3Anull%2C%22annotation_layers%22%3A%5B%5D%2C%22number_format%22%3A%22.3s%22%2C%22y_axis_showminmax%22%3Atrue%7D&standalone=true&height=300"
                    >
                    </iframe>
            </td>
            
        {% for item in fieldset_item[1].get('fields') %}
            <tr id="doc_info_row">
            <th id="doc_info_label" class="col-lg-2 col-md-2 col-sm-2">{{label_columns.get(item)}}</th>
            <td><span style="white-space: pre-line">{{value_columns[include_columns.index(item)]}}</span></td>
            </tr>
        {% endfor %}
        </table></div>
        {% endcall %}
    {% endfor %}

{% else %}
    <div class="table-responsive">
    <table class="table table-bordered">

    {% for item in include_columns %}
        <tr>
            <th class="col-lg-2 col-md-2 col-sm-2">{{label_columns.get(item)}}</th>
            <td>
                {% set formatter = formatters_columns.get(item) %}
                {% set v = value_columns[loop.index-1]%}
                <span style="white-space: pre-line">{{formatter(v) if formatter else v}}</span>
            </td>
        </tr>
    {% endfor %}
    </table></div>
{% endif %}


<div class="well well-sm">
    {{ lib.render_action_links(actions, pk, modelview_name) }}
    {{ lib.lnk_back() }}
</div>
